<html>

    <head>
        <title>Sign up</title>
    </head>

    <body>
        <div>
            <button id='loginButton'>Login with MetaMask</button>
            <form method="POST" action="auth/registration">
                <label>Имя</label>
                <input type="text" name="username" />
                <label>Адрес кошелька</label>
                <input type="text" name="walletAddress" id="walletAddress"/>
                <input type="submit" value="Подтвердить"/>
            </form>
        </div>

    <script>
        window.userWalletAddress = null
        const loginButton = document.getElementById('loginButton')
        const walletAddress = document.getElementById('walletAddress')

        function toggleButton() {
        if (!window.ethereum) {
            loginButton.innerText = 'MetaMask is not installed'
            return false
        }

        function addWallet(value) {
            let input = document.getElementById("walletAddress"); 
            input.value = value;
        }

        loginButton.addEventListener('click', loginWithMetaMask)
        }

        async function loginWithMetaMask() {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' })
            .catch((e) => {
            console.error(e.message)
            return
            })
        if (!accounts) { return }

        window.userWalletAddress = accounts[0]
        walletAddress.value = window.userWalletAddress
        loginButton.innerText = 'Sign out of MetaMask'

        loginButton.removeEventListener('click', loginWithMetaMask)
        setTimeout(() => {
            loginButton.addEventListener('click', signOutOfMetaMask)
        }, 200)
        }

        function signOutOfMetaMask() {
        window.userWalletAddress = null
        walletAddress.innerText = ''
        loginButton.innerText = 'Sign in with MetaMask'

        loginButton.removeEventListener('click', signOutOfMetaMask)
        setTimeout(() => {
            loginButton.addEventListener('click', loginWithMetaMask)
        }, 200)
        }

        window.addEventListener('DOMContentLoaded', () => {
        toggleButton()
        });
    </script>
    </body>

</html>